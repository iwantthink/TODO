# 全埋点实现

# 简介

 
# 1. 实现Activity的生命周期埋点


# 2. 控件埋点

**需求:**

给所有控件的监听回调添加 SDK事件.

针对不同类型的监听回调可以分为:

1.  View.OnClickListener

2. 重写onTouchEvent

3. 其它



## 2.1 单击事件埋点

当项目中任意一个控件被点击(触发`onClickListener`),那么就要对这个点击事件进行AOP操作

流程:

1. 对项目中所有代码进行扫描,筛选出实现了`View.onClickListener`接口的类(匿名或非匿名)

2. 对`onClick()`方法的字节码进行修改


## 2.2 所遇到的问题


### 2.2.1 按钮是否已经设置了事件?

1. `Button` 已经设置了事件

2. `Button` 没有设置事件 (理论上来说应该不需要管这种情况,因为如果开发者都没有对这个按钮设置事件,那说明这个按钮不需要监听事件)

### 2.2.2 如何区分控件类型?


### 2.2.3 如何针对指定类型控件添加事件?

要搞清楚这个,就得知道 不同情况下`Button.setOnClickListener()`代码的字节码指令是什么形式(对应ASM对调是什么情况)

考虑俩点:

1. 变量类型,局部变量,成员变量,静态变量

2. 


### 2.2.4 如何仅针对一种类型的控件 添加事件?


### 2.2.5 设置点击事件的代码形式

1. 获取控件实例,调用其`setOnClickListener`

2. 在布局文件中直接对控件的属性进行设置,添加`android:onClick="click"`属性,在其对应的Activity文件中 编写回调

**目前仅支持第一种情况,第二种形式是通过反射直接调用控件所在Activity 的回调**

- 第二种形式的话,可以通过传入方法名 和 方法描述符 . 让插件对这个指定的方法也做AOP操作