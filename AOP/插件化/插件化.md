# 插件化

[Android插件化和热修复知识梳理](https://www.jianshu.com/p/704cac3eb13d)

[Andoird 插件化框架总结](https://juejin.im/entry/59decdf36fb9a0451c39621b)

[Android插件化原理解析——概要](http://weishu.me/2016/01/28/understand-plugin-framework-overview/)

[【Android 修炼手册】常用技术篇 -- Android 插件化解析](https://zhuanlan.zhihu.com/p/72759579)

# 1. 简介

首先需要明确的一点，**插件化和热修复不是同一个概念**，虽然站在技术实现的角度来说，他们都是从系统加载器的角度出发，无论是采用hook方式，亦或是代理方式或者是其他底层实现，都是通过“欺骗”Android 系统的方式来让宿主正常的加载和运行插件（补丁）中的内容；但是二者的出发点是不同的。

- 插件化顾名思义，更多是想把需要实现的模块或功能当做一个独立的提取出来，减少宿主的规模，当需要使用到相应的功能时再去加载相应的模块。

- 热修复则往往是从修复bug的角度出发，强调的是在不需要二次安装应用的前提下修复已知的bug。

**插件化所衍生出来的内容：**
![](https://upload-images.jianshu.io/upload_images/1115031-70a55fecac4da43b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/543)

# 2. 插件化的问题

插件化需要解决俩个问题：

1. 代码加载

	类的加载可以通过ClassLoader机制，但是对于Android，一个类并不是加载进来就可以使用，它需要一个生命周期的来进行管理

	另外，如果管理加载进来的类也是问题。例如，多个插件依赖了相同的类，是抽取公共依赖进行管理还是插件单独依赖，这就是ClassLoader的管理问题。

2. 资源加载

	大部分资源加载方案都是通过AssetManager的隐藏方法addAssetPath。

	但是，对于不同的插件资源如何进行管理？是公用资源还是独立资源，公用资源如何避免资源冲突？

3. 生命周期

	如果是一个普通类，那么直接通过`DexClassLoader`加载进来即可执行。但是如果该类是Android中的四大组件，这些类需要和系统进行交互，如何让加载进来的四大组件和系统进行交互就成了问题!
	
4. 清单文件

	Android中的四大组件是需要在`AndroidManifest.xml`中进行注册才能正确使用,否则将会被系统服务检测出问题，而插件化的内容并不能被非常灵活的添加（提前声明大量的插件中将使用的组件这种形式过于麻烦），那么如何灵活且简答的实现就成了问题？


 	