# 参考链接
[Android 热修复Nuwa的原理以及Gradle插件源码解析](http://blog.csdn.net/sbsujjbcy/article/details/50812674)


# 1.热修复技术
[安卓APP热补丁动态修复技术介绍](https://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&mid=400118620&idx=1&sn=b4fdd5055731290eef12ad0d17f39d4a&scene=0#wechat_redirect)

**参考文章可以总结出qq空间热修复的步骤**：
- 动态加载补丁dex，并将补丁dex插入到dexElements最前面
- 要实现热更新，需要热更新的类要防止被打上ISPREVERIFIED标记，关于这个标记请阅读文章


1. 要实现第一点，需要通过DexClassLoader对象，将补丁dex对象加载进来，再通过反射将补丁dex插入到dexElements最前面即可。参考：[Google-Multidex](https://developer.android.com/studio/build/multidex.html?hl=zh-cn)
2. 要实现第二点，就是将所有类的构造函数中，引用另一个`hack.dex`中的类，这个类叫`Hack.class`，然后在加载补丁`patch.dex`前动态加载这个`hack.dex`，**但是有一个类的构造函数中不能引用`Hack.class`，这个类就是Application类的子类，一旦这个类的构造函数中加入Hack.class这个类，那么程序运行时就会找不到`Hack.class`这个类，因为还没有被加载**。也就是说，一个类直接引用到的类不在同一个dex中即可。这样，就能防止类被打上`ISPREVERIFIED`标记并能进行热更新


# 2. Gradle插件实现代码插入
Gradle插件需要做的事情是拿到所有的class,在其构造函数中注入`Hack.class`(只是一个空类)，使其直接引用另一个DEX文件,防止被打上`ISPREVERIFIED`标记。并且混淆的时候要应用上一次release版本的mapping文件。

- **现在有两点关键内容**：
	- 如何拿到所有的class
	- 如何在构造函数中注入代码


## 2.1 如何在构造函数中注入代码
